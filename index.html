<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Music Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Montserrat:wght@400;700&display=swap');
        :root { --bg: #050505; --cyan: #00f2ff; --pink: #ff007f; --card: #121212; }
        
        body { margin: 0; background: var(--bg); color: white; font-family: 'Montserrat', sans-serif; height: 100vh; display: flex; flex-direction: column; }
        
        .header { padding: 20px; text-align: center; border-bottom: 2px solid var(--cyan); background: rgba(0,242,255,0.05); }
        .header h1 { font-family: 'Orbitron', sans-serif; font-size: 18px; color: var(--cyan); margin: 0; text-shadow: 0 0 10px var(--cyan); }

        /* –ü–ª–µ–µ—Ä (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–Ω–∏–∑—É) */
        .player-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #1a1a1a; padding: 15px; border-top: 1px solid var(--cyan);
            display: none; flex-direction: column; gap: 10px; z-index: 1000;
        }
        audio { width: 100%; height: 35px; filter: invert(1); }

        .search-section { padding: 15px; }
        .search-bar { 
            width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #333; 
            background: var(--card); color: white; outline: none; box-sizing: border-box;
        }

        .playlist { flex-grow: 1; overflow-y: auto; padding: 0 15px 120px; }
        .track-card { 
            background: var(--card); border-radius: 15px; padding: 15px; 
            display: flex; align-items: center; margin-bottom: 10px; 
            border: 1px solid rgba(255,255,255,0.05); transition: 0.2s;
        }
        .track-card:active { background: #1a1a1a; }
        .track-info { flex-grow: 1; }
        .t-title { font-weight: 700; font-size: 15px; color: var(--cyan); display: block; }
        .t-artist { font-size: 12px; color: #888; }
        
        .play-btn { 
            background: var(--cyan); color: black; border: none; 
            padding: 10px 18px; border-radius: 10px; font-weight: 900; 
        }

        .results { 
            position: absolute; top: 130px; left: 15px; right: 15px; 
            background: #1a1a1a; border-radius: 12px; z-index: 100; 
            display: none; border: 1px solid #444; max-height: 300px; overflow-y: auto;
        }
        .res-item { padding: 12px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div class="header"><h1>NEON MUSIC PRO</h1></div>

    <div class="search-section">
        <input type="text" class="search-bar" id="search-input" placeholder="üîç –í–≤–µ–¥–∏ –∞—Ä—Ç–∏—Å—Ç–∞ –∏–ª–∏ –ø–µ—Å–Ω—é..." oninput="searchMusic()">
    </div>

    <div class="results" id="results"></div>
    <div class="playlist" id="playlist"></div>

    <div class="player-bar" id="player-bar">
        <div id="now-playing-info" style="font-size: 12px; font-weight: bold; color: var(--cyan);"></div>
        <audio id="main-audio" controls autoplay></audio>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let tracks = [];
        const audio = document.getElementById('main-audio');

        async function searchMusic() {
            const query = document.getElementById('search-input').value;
            const resDiv = document.getElementById('results');
            if (query.length < 3) { resDiv.style.display = 'none'; return; }

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑—É iTunes (–æ–Ω–∞ –Ω–µ –∑–∞–±–ª–æ–∫–∞–Ω–∞ –∏ –¥–∞–µ—Ç –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã)
            const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=7`);
            const data = await response.json();

            resDiv.innerHTML = '';
            data.results.forEach(song => {
                const item = document.createElement('div');
                item.className = 'res-item';
                item.innerHTML = `
                    <div><b>${song.trackName}</b><br><small>${song.artistName}</small></div>
                    <button class="play-btn" onclick="addTrack('${song.trackName.replace(/'/g,"")}', '${song.artistName.replace(/'/g,"")}', '${song.previewUrl}')">ADD</button>
                `;
                resDiv.appendChild(item);
            });
            resDiv.style.display = 'block';
        }

        function addTrack(title, artist, url) {
            tracks.push({ title, artist, url });
            document.getElementById('results').style.display = 'none';
            document.getElementById('search-input').value = '';
            tg.HapticFeedback.notificationOccurred('success');
            render();
        }

        function playFile(url, title, artist) {
            const playerBar = document.getElementById('player-bar');
            const info = document.getElementById('now-playing-info');
            
            audio.src = url;
            info.textContent = `–ò–ì–†–ê–ï–¢: ${artist} - ${title}`;
            playerBar.style.display = 'flex';
            
            audio.play().catch(e => {
                console.log("–ê–≤—Ç–æ–ø–ª–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –Ω—É–∂–Ω–æ –Ω–∞–∂–∞—Ç—å Play –≤—Ä—É—á–Ω—É—é");
            });

            tg.HapticFeedback.impactOccurred('medium');
        }

        function render() {
            const container = document.getElementById('playlist');
            container.innerHTML = '';
            tracks.forEach(t => {
                const card = document.createElement('div');
                card.className = 'track-card';
                card.onclick = () => playFile(t.url, t.title, t.artist);
                card.innerHTML = `
                    <div class="track-info">
                        <span class="t-title">${t.title}</span>
                        <span class="t-artist">${t.artist}</span>
                    </div>
                    <div style="color:var(--cyan); font-size:20px;">‚ñ∂</div>
                `;
                container.appendChild(card);
            });
        }
    </script>
</body>
</html>
